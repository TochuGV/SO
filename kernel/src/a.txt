void enviar_peticion_io(int socket_io, char* dispositivo, int duracion, uint32_t pid){
  t_paquete* paquete = crear_paquete(PETICION_IO);

  agregar_a_paquete(paquete, &pid, sizeof(uint32_t));
  agregar_a_paquete_con_longitud(paquete, dispositivo);
  agregar_a_paquete(paquete, &duracion, sizeof(uint32_t));

  enviar_a_paquete(paquete, socket_io);
  eliminar_paquete(paquete);
};

void manejar_respuesta_io(char* nombre_dispositivo, uint32_t pid) {
  t_dispositivo_io* disp = dictionary_get(dispositivos_io, nombre_dispositivo);
  if (!disp) return;

  t_pcb* pcb = obtener_pcb_por_pid(pid);
  if (!pcb) return;

  encolar_en_ready(pcb);
  cambiar_estado(pcb, ESTADO_BLOCKED, ESTADO_READY);
  mover_proceso_a_exec();

  if (!queue_is_empty(disp->cola_bloqueados)) {
    t_pcb* siguiente = queue_pop(disp->cola_bloqueados);
    enviar_peticion_io(disp->socket, nombre_dispositivo, siguiente->duracion_io, siguiente->pid); // Debés guardar `duracion_io` si no lo hacés
    disp->ocupado = true;
  } else {
    disp->ocupado = false;
  }
}

void registrar_socket_io(char* nombre, int socket) {
  t_dispositivo_io* disp = dictionary_get(dispositivos_io, nombre);
  if (disp != NULL) {
    disp->socket = socket;
    log_info(logger, "Socket IO registrado para <%s>", nombre);
  }
}